#!/bin/bash
#
# netmrg_cron.sh
#
# a shell script to remove lockfiles and rotate output if it died
#

mailto="root"
netmrg="@exec_prefix@/bin/netmrg-gatherer"
lockfile="@prefix@/var/log/netmrg/lockfile"
output="@prefix@/var/log/netmrg/lastrun.log"
error="@prefix@/var/log/netmrg/lastrun.err"
curdate=`date +%s`

if [ -e $lockfile ] ; then
	lastrun=`cat $lockfile`;
	rundiff=$(($curdate - $lastrun));
	echo "NetMRG died on its run $rundiff seconds ago.  I'll remove the lockfile" | mail -s "NetMRG died at $lastrun" $mailto
	mv -f $output $output.$lastrun
	mv -f $error $error.$lastrun
	rm -f $lockfile
fi

$netmrg > $output 2> $error
